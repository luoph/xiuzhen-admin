<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jeecg.modules.player.mapper.PlayerItemLogMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="org.jeecg.modules.player.entity.PlayerItemLog">
        <id column="id" property="id"/>
        <result column="player_id" property="playerId"/>
        <result column="item_id" property="itemId"/>
        <result column="num" property="num"/>
        <result column="way" property="way"/>
        <result column="type" property="type"/>
        <result column="sync_time" property="syncTime"/>
        <result column="item_num" property="itemNum"/>
        <result column="add_item_num" property="addItemNum"/>
        <result column="consume_item_num" property="consumeItemNum"/>
        <result column="way_name" property="wayName"/>
        <result column="player_num" property="playerNum"/>
        <result column="item_count" property="itemCount"/>
        <result column="item_num_rate" property="itemNumRate"/>
        <result column="item_num_sum" property="itemNumSum"/>
    </resultMap>

    <select id="queryCurrencyPayIncomeList" resultMap="BaseResultMap">
        SELECT
        sync_time,
        SUM(num) add_item_num
        FROM player_item_log
        WHERE
        item_id = #{itemId}
        AND type = #{type}
        AND sync_time >= #{rangeDateBeginTime} AND sync_time &lt;= #{rangeDateEndTime}
        <if test="serverId != 0">
            AND server_id = #{serverId}
        </if>
        GROUP BY sync_time
        ORDER BY add_item_num DESC
    </select>

    <select id="getBySyncTime" resultType="BigDecimal">
        SELECT
        SUM(num) consume_item_num
        FROM player_item_log
        WHERE
        item_id = #{itemId}
        AND type = #{type}
        AND sync_time = #{syncTime}
        <if test="serverId != 0">
            AND server_id = #{serverId}
        </if>
    </select>

    <select id="queryWayDistributeList" resultMap="BaseResultMap">
        SELECT
        way,
        SUM(num) item_num,
        COUNT(DISTINCT(player_id)) player_num
        FROM
        player_item_log
        WHERE
        item_id = #{itemId}
        AND type = #{type}
        AND sync_time >= #{rangeDateBeginTime} AND sync_time &lt;= #{rangeDateEndTime}
        <if test="serverId != 0">
            AND server_id = #{serverId}
        </if>
        GROUP BY way
        ORDER BY item_num DESC
    </select>

    <select id="queryItemSum" resultType="BigDecimal">
        SELECT
        SUM(num) item_num_sum
        FROM
        player_item_log
        WHERE
        type = #{type}
        AND sync_time >= #{rangeDateBeginTime} AND sync_time &lt;= #{rangeDateEndTime}
        <if test="serverId != 0">
            AND server_id = #{serverId}
        </if>
    </select>

    <select id="queryItemCount" resultType="BigDecimal">
        SELECT
        COUNT(way) item_count
        FROM
        player_item_log
        WHERE
        item_id = #{itemId}
        AND type = #{type}
        AND sync_time >= #{rangeDateBeginTime} AND sync_time &lt;= #{rangeDateEndTime}
        <if test="serverId != 0">
            AND server_id = #{serverId}
        </if>
    </select>

    <select id="queryItemBillList" resultMap="BaseResultMap">
        SELECT
        player_id,
        item_id,
        way,
        type,
        before_num,
        num,
        after_num,
        sync_time
        FROM
        player_item_log
        <where>
            <if test="playerId !=0 ">
                AND player_id = #{playerId}
            </if>
            <if test="itemId !=0 ">
                AND item_id = #{itemId}
            </if>
            <if test="type !=0 ">
                AND type = #{type}
            </if>
            <if test="way !=0 ">
                AND way = #{way}
            </if>
            <if test="rangeDateBeginTime !=null ">
                AND sync_time >= #{rangeDateBeginTime}
            </if>
            <if test="rangeDateEndTime !=null ">
                AND sync_time &lt;= #{rangeDateEndTime}
            </if>
        </where>

    </select>
</mapper>